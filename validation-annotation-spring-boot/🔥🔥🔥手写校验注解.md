---
theme: qklhk-chocolate
highlight: atom-one-dark
---

# æœ¬ç« æºç ä¸‹è½½
ğŸ”¥ğŸ”¥ğŸ”¥[æœ¬ç« æºç ä¸‹è½½å·²åˆ†äº«github](https://github.com/liangjianweiLJW/java-guide/tree/master/validation-annotation-spring-boot)

# å‰è¨€
åœ¨é¡¹ç›®ä¸­æˆ‘ä»¬ç»å¸¸è¿›è¡Œæ ¡éªŒæ•°æ®åˆæ³•æ€§ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨åˆ°javax.validation.constraintsåŒ…ä¸‹æ³¨è§£ï¼Œå¦‚@NotBlank
@NotEmptyï¼Œ@NotNullç­‰ã€‚æˆ‘ä»¬å‘ç°springå¹¶æ²¡æœ‰æä¾›ä¸€ä¸ªæšä¸¾å€¼çš„æ£€éªŒæ³¨è§£ï¼Œæ‰€ä»¥æœ¬æ–‡å®æˆ˜æ‰‹å†™ä¸€ä¸ªè¿™æ ·åŠŸèƒ½çš„æ³¨è§£ã€‚


# å…ƒæ³¨è§£
å…ƒæ³¨è§£æ˜¯è´Ÿè´£å¯¹å…¶å®ƒæ³¨è§£è¿›è¡Œè¯´æ˜çš„æ³¨è§£ï¼Œè‡ªå®šä¹‰æ³¨è§£æ—¶å¯ä»¥ä½¿ç”¨å…ƒæ³¨è§£ã€‚Java5 å®šä¹‰ 4ä¸ªæ³¨è§£ï¼Œåˆ†åˆ«æ˜¯ @Documentedã€@Targetã€@Retention å’Œ @Inheritedã€‚

Java 8 åˆå¢åŠ äº† @Repeatable å’Œ @Native ä¸¤ä¸ªæ³¨è§£ã€‚è¿™äº›æ³¨è§£éƒ½å¯ä»¥åœ¨ java.lang.annotation åŒ…ä¸­æ‰¾åˆ°ã€‚ä¸‹é¢ä¸»è¦ä»‹ç»æ¯ä¸ªå…ƒæ³¨è§£çš„ä½œç”¨åŠä½¿ç”¨ã€‚


## @Documented

@Documented æ˜¯ä¸€ä¸ªæ ‡è®°æ³¨è§£ï¼Œæ²¡æœ‰æˆå‘˜å˜é‡ã€‚ç”¨ @Documented æ³¨è§£ä¿®é¥°çš„æ³¨è§£ç±»ä¼šè¢« JavaDoc å·¥å…·æå–æˆæ–‡æ¡£ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒJavaDoc æ˜¯ä¸åŒ…æ‹¬æ³¨è§£çš„ï¼Œä½†å¦‚æœå£°æ˜æ³¨è§£æ—¶æŒ‡å®šäº† @Documentedï¼Œå°±ä¼šè¢« JavaDoc ä¹‹ç±»çš„å·¥å…·å¤„ç†ï¼Œæ‰€ä»¥æ³¨è§£ç±»å‹ä¿¡æ¯å°±ä¼šè¢«åŒ…æ‹¬åœ¨ç”Ÿæˆçš„å¸®åŠ©æ–‡æ¡£ä¸­ã€‚


## @Target

@Target æ³¨è§£ç”¨æ¥æŒ‡å®šä¸€ä¸ªæ³¨è§£çš„ä½¿ç”¨èŒƒå›´ï¼Œå³è¢« @Target ä¿®é¥°çš„æ³¨è§£å¯ä»¥ç”¨åœ¨ä»€ä¹ˆåœ°æ–¹ã€‚@Target æ³¨è§£æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡ï¼ˆvalueï¼‰ç”¨æ¥è®¾ç½®é€‚ç”¨ç›®æ ‡ï¼Œvalue æ˜¯ java.lang.annotation.ElementType æšä¸¾ç±»å‹çš„æ•°ç»„ï¼Œä¸‹è¡¨ä¸º ElementType å¸¸ç”¨çš„æšä¸¾å¸¸é‡ã€‚


| åç§°             | è¯´æ˜                      |
| -------------- | ----------------------- |
| CONSTRUCTOR    | ç”¨äºæ„é€ æ–¹æ³•                  |
| FIELD          | ç”¨äºæˆå‘˜å˜é‡ï¼ˆåŒ…æ‹¬æšä¸¾å¸¸é‡ï¼‰          |
| LOCAL_VARIABLE | ç”¨äºå±€éƒ¨å˜é‡                  |
| METHOD         | ç”¨äºæ–¹æ³•                    |
| PACKAGE        | ç”¨äºåŒ…                     |
| PARAMETER      | ç”¨äºç±»å‹å‚æ•°ï¼ˆJDK 1.8æ–°å¢ï¼‰       |
| TYPE           | ç”¨äºç±»ã€æ¥å£ï¼ˆåŒ…æ‹¬æ³¨è§£ç±»å‹ï¼‰æˆ– enum å£°æ˜ |

## @Retention

@Retention ç”¨äºæè¿°æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¹Ÿå°±æ˜¯è¯¥æ³¨è§£è¢«ä¿ç•™çš„æ—¶é—´é•¿çŸ­ã€‚@Retention æ³¨è§£ä¸­çš„æˆå‘˜å˜é‡ï¼ˆvalueï¼‰ç”¨æ¥è®¾ç½®ä¿ç•™ç­–ç•¥ï¼Œvalue æ˜¯ java.lang.annotation.RetentionPolicy æšä¸¾ç±»å‹ï¼ŒRetentionPolicy æœ‰ 3 ä¸ªæšä¸¾å¸¸é‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

1.  SOURCEï¼šåœ¨æºæ–‡ä»¶ä¸­æœ‰æ•ˆï¼ˆå³æºæ–‡ä»¶ä¿ç•™ï¼‰
1.  CLASSï¼šåœ¨ class æ–‡ä»¶ä¸­æœ‰æ•ˆï¼ˆå³ class ä¿ç•™ï¼‰
1.  RUNTIMEï¼šåœ¨è¿è¡Œæ—¶æœ‰æ•ˆï¼ˆå³è¿è¡Œæ—¶ä¿ç•™ï¼‰


ç”Ÿå‘½å‘¨æœŸå¤§å°æ’åºä¸º SOURCE < CLASS < RUNTIMEï¼Œå‰è€…èƒ½ä½¿ç”¨çš„åœ°æ–¹åè€…ä¸€å®šä¹Ÿèƒ½ä½¿ç”¨ã€‚å¦‚æœéœ€è¦åœ¨è¿è¡Œæ—¶å»åŠ¨æ€è·å–æ³¨è§£ä¿¡æ¯ï¼Œé‚£åªèƒ½ç”¨ RUNTIME æ³¨è§£ï¼›

å¦‚æœè¦åœ¨ç¼–è¯‘æ—¶è¿›è¡Œä¸€äº›é¢„å¤„ç†æ“ä½œï¼Œæ¯”å¦‚ç”Ÿæˆä¸€äº›è¾…åŠ©ä»£ç ï¼ˆå¦‚ ButterKnifeï¼‰ï¼Œå°±ç”¨ CLASS æ³¨è§£ï¼›

å¦‚æœåªæ˜¯åšä¸€äº›æ£€æŸ¥æ€§çš„æ“ä½œï¼Œæ¯”å¦‚ @Override å’Œ @SuppressWarningsï¼Œåˆ™å¯é€‰ç”¨ SOURCE æ³¨è§£ã€‚



## @Inherited

@Inherited æ˜¯ä¸€ä¸ªæ ‡è®°æ³¨è§£ï¼Œç”¨æ¥æŒ‡å®šè¯¥æ³¨è§£å¯ä»¥è¢«ç»§æ‰¿ã€‚ä½¿ç”¨ @Inherited æ³¨è§£çš„ Class ç±»ï¼Œè¡¨ç¤ºè¿™ä¸ªæ³¨è§£å¯ä»¥è¢«ç”¨äºè¯¥ Class ç±»çš„å­ç±»ã€‚å°±æ˜¯è¯´å¦‚æœæŸä¸ªç±»ä½¿ç”¨äº†è¢«Â @Inherited ä¿®é¥°çš„æ³¨è§£ï¼Œåˆ™å…¶å­ç±»å°†è‡ªåŠ¨å…·æœ‰è¯¥æ³¨è§£ã€‚

## @Repeatable

@Repeatable æ³¨è§£æ˜¯ Java 8 æ–°å¢åŠ çš„ï¼Œå®ƒå…è®¸åœ¨ç›¸åŒçš„ç¨‹åºå…ƒç´ ä¸­é‡å¤æ³¨è§£ï¼Œåœ¨éœ€è¦å¯¹åŒä¸€ç§æ³¨è§£å¤šæ¬¡ä½¿ç”¨æ—¶ï¼Œå¾€å¾€éœ€è¦å€ŸåŠ© @Repeatable æ³¨è§£ã€‚Java 8 ç‰ˆæœ¬ä»¥å‰ï¼ŒåŒä¸€ä¸ªç¨‹åºå…ƒç´ å‰æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªç›¸åŒç±»å‹çš„æ³¨è§£ï¼Œå¦‚æœéœ€è¦åœ¨åŒä¸€ä¸ªå…ƒç´ å‰ä½¿ç”¨å¤šä¸ªç›¸åŒç±»å‹çš„æ³¨è§£ï¼Œåˆ™å¿…é¡»ä½¿ç”¨æ³¨è§£â€œå®¹å™¨â€ã€‚


Java 8 ä¹‹å‰çš„åšæ³•ï¼š

```java
public @interface Roles {
    Role[] roles();
}

public @interface Role {
    String roleName();
}

public class RoleTest {
    @Roles(roles = {
            @Role(roleName = "role1"),
            @Role(roleName = "role2")
     })
    public String doString(){
        return "hello";
    }
}
```

Java 8 ä¹‹åå¢åŠ äº†é‡å¤æ³¨è§£ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š
```java
public @interface Roles {
    Role[] value();
}

@Repeatable(Roles.class)
public @interface Role {
    String roleName();
}

public class RoleTest {
    @Role(roleName = "role1")
    @Role(roleName = "role2")
    public String doString(){
        return "hello";
    }
}
```

ä¸åŒçš„åœ°æ–¹æ˜¯ï¼Œåˆ›å»ºé‡å¤æ³¨è§£ Role æ—¶åŠ ä¸Šäº† @Repeatable æ³¨è§£ï¼ŒæŒ‡å‘å­˜å‚¨æ³¨è§£ Rolesï¼Œè¿™æ ·åœ¨ä½¿ç”¨æ—¶å°±å¯ä»¥ç›´æ¥é‡å¤ä½¿ç”¨ Role æ³¨è§£ã€‚ä»ä¸Šé¢ä¾‹å­çœ‹å‡ºï¼Œä½¿ç”¨ @Repeatable æ³¨è§£æ›´ç¬¦åˆå¸¸è§„æ€ç»´ï¼Œå¯è¯»æ€§å¼ºä¸€ç‚¹ã€‚

ä¸¤ç§æ–¹æ³•è·å¾—çš„æ•ˆæœç›¸åŒã€‚é‡å¤æ³¨è§£åªæ˜¯ä¸€ç§ç®€åŒ–å†™æ³•ï¼Œè¿™ç§ç®€åŒ–å†™æ³•æ˜¯ä¸€ç§å‡è±¡ï¼Œå¤šä¸ªé‡å¤æ³¨è§£å…¶å®ä¼šè¢«ä½œä¸ºâ€œå®¹å™¨â€æ³¨è§£çš„ value æˆå‘˜çš„æ•°ç»„å…ƒç´ å¤„ç†ã€‚

## @Native

ä½¿ç”¨ @Native æ³¨è§£ä¿®é¥°æˆå‘˜å˜é‡ï¼Œåˆ™è¡¨ç¤ºè¿™ä¸ªå˜é‡å¯ä»¥è¢«æœ¬åœ°ä»£ç å¼•ç”¨ï¼Œå¸¸å¸¸è¢«ä»£ç ç”Ÿæˆå·¥å…·ä½¿ç”¨ã€‚

# å®æˆ˜
## æ·»åŠ ä¾èµ–
JSR-303æ˜¯Javaä¸ºBeanæ•°æ®åˆæ³•æ€§æ ¡éªŒæä¾›çš„æ ‡å‡†æ¡†æ¶ï¼Œå®ƒå®šä¹‰äº†ä¸€æ•´å¥—æ ¡éªŒæ³¨è§£ï¼Œå¯ä»¥æ ‡æ³¨åœ¨æˆå‘˜å˜é‡ï¼Œå±æ€§æ–¹æ³•ç­‰ä¹‹ä¸Šã€‚

hibernate-validatorå°±æä¾›äº†è¿™å¥—æ ‡å‡†çš„å®ç°ï¼Œæˆ‘ä»¬åœ¨ç”¨Springbootå¼€å‘webåº”ç”¨æ—¶ï¼Œä¼šå¼•å…¥**spring-boot-starter-webä¾èµ–ï¼Œå®ƒé»˜è®¤ä¼šå¼•å…¥spring-boot-starter-validationä¾èµ–**ï¼Œè€Œspring-boot-starter-validationä¸­å°±å¼•ç”¨äº†hibernate-validatorä¾èµ–ã€‚

**åœ¨springbootè¾ƒé«˜çš„ç‰ˆæœ¬ä¸­ï¼Œspring-boot-starter-webå·²ç§»é™¤åŒ…å«çš„hibernate-validatorç»„ä»¶ï¼Œè¯·å•ç‹¬å¼•å…¥hibernate-validator**
```xml
<dependency>
    <groupId>org.hibernate.validator</groupId>
    <artifactId>hibernate-validator</artifactId>
    <version>7.0.2.Final</version>
</dependency>
```

**å¦‚æœæ˜¯spring boot2.xé¡¹ç›®ï¼Œæ¨èç›´æ¥å¼•ç”¨ä¸‹é¢è¿™ä¸ªä¾èµ–ï¼Œç¡®ä¿ç‰ˆæœ¬å’Œspringbootçš„ç‰ˆæœ¬åŒ¹é…ï¼Œå¦åˆ™æœ‰å¯èƒ½å‡ºç°@Validå¤±æ•ˆæƒ…å†µè€Œé¡¹ç›®ä¸ä¼šæŠ¥é”™**

æ¨èè‡ªåŠ¨é€‚é…springbootç‰ˆæœ¬ï¼š
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-validation</artifactId>
</dependency>
```

## å®æˆ˜1ï¼šæ ¡éªŒå‚æ•°æ˜¯å¦åœ¨åˆ—ä¸¾çš„èŒƒå›´å†…
### åˆ—ä¸¾æ³¨è§£
```java
@Documented
@Constraint(validatedBy = {ListValusConstraintValidator.class})
@Target({METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE})
@Retention(RUNTIME)
public @interface ListValue {

    //é»˜è®¤è¿”å›æç¤ºä¿¡æ¯
    String message() default "å‚æ•°ä¸åŒ¹é…!";
    //é»˜è®¤åˆ†ç»„
    Class<?>[] groups() default {};
    //é»˜è®¤è½½ä½“
    Class<? extends Payload>[] payload() default {};

    /**
     * è‡ªå®šä¹‰
     * éœ€è¦æ ¡éªŒStringæ•°ç»„
     * @return
     */
    String[] value();

    /**
     * è‡ªå®šä¹‰
     * true å¿…ä¼ 
     * false éå¿…ä¼ 
     * 
     * @return
     */
    boolean required() default true;
}
```
@Constraintæ³¨è§£å¯ä»¥æ³¨å†Œå¤šä¸ªéªŒè¯å™¨è¿›è¡ŒéªŒè¯ã€‚

### æ³¨è§£çº¦æŸéªŒè¯å™¨
```java
/**
 * @Description: Interger listé›†åˆæ ¡éªŒå™¨
 * @Author: jianweil
 */
public class ListValusConstraintValidator implements ConstraintValidator<ListValue, Object> {

    private Set<Object> valus = new HashSet<>();
    boolean required = true;

    @Override
    public void initialize(ListValue constraintAnnotation) {
        try {
            String[] value = constraintAnnotation.value();
            for (String i : value) {
                valus.add(i);
            }
            required = constraintAnnotation.required();
        } catch (Exception e) {
            throw new RuntimeException("å‚æ•°æ ¡éªŒè½¬æ¢å‡ºé”™", e);
        }
    }

    /**
     * æ˜¯å¦æ ¡éªŒæˆåŠŸ
     *
     * @param value   æ ¡éªŒå€¼ è¿™é‡Œä½¿ç”¨Objectæ˜¯å…¼é¡¾äº†intç±»å‹å’ŒStringç±»å‹ï¼Œä¸¥æ ¼æ¥è¯´æ˜¯è¦åˆ†åˆ«æ–°å»ºä¸¤ä¸ªç±»å‹çš„æ³¨è§£çº¦æŸéªŒè¯å™¨
     * @param context
     * @return
     */
    @Override
    public boolean isValid(Object value, ConstraintValidatorContext context) {
        if (required) {
            if (Objects.isNull(value)) {
                //valueä¸ºnull
                return false;
            }
            return valus.contains(value.toString());
        } else {
            //valueå¯ä»¥ä¸ºnull
            if (value == null) {
                return true;
            } else {
                //å¦‚æœvalueä¸ä¸ºnullï¼Œæ ¡éªŒæ˜¯å¦æ˜¯åˆ—ä¸¾çš„å€¼
                return valus.contains(value.toString());
            }
        }
    }
}
```
Spring MVC æ¡†æ¶ä¼šå»è°ƒç”¨ `initialize`æ–¹æ³•å¯¹å½“å‰è¿™ä¸ªæ³¨è§£çš„æ‹“å±•è¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶ååœ¨æ ¡éªŒè¿‡ç¨‹ä¸­ä¼šæ‰§è¡Œ `isValid` å¦‚æœæ ¡éªŒé€šè¿‡æˆ‘ä»¬å°±è¿”å› true,ä¸é€šè¿‡æˆ‘ä»¬å°±è¿”å› false

å¦‚æœä¸é€šè¿‡ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¼‚å¸¸çš„é”™è¯¯ä¿¡æ¯ä¸­ä¼šåŒ…å«æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„ message.

### è¯·æ±‚VO
```java
/**
 * @Description: ç”¨æˆ·VO
 * @Author: jianweil
 * @date: 2022/3/1 10:03
 */
@Data
public class UserVO {

    @NotBlank(message = "å§“åä¸èƒ½ä¸ºç©º")
    private String name;

    @Min(value = 18, message = "å¹´é¾„ä¸èƒ½å°äº18")
    private int age;

    /**
     * åˆ—ä¸¾æ€§åˆ«æšä¸¾å€¼: 1å¥³ 2ç”·
     */
    @ListValue(value = {"1", "2"}, message = "æ€§åˆ«å‚æ•°ä¸å¯¹")
    private Integer gender;

    @NotBlank(message = "é‚®ç®±ä¸èƒ½ä¸ºç©º")
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;

}
```
### æ§åˆ¶å™¨@Validæ ¡éªŒ
```java
@RestController
@RequestMapping("/test")
public class TestController {

    /**
     * æ•è·æ•°æ®ç»‘å®šç»“æœï¼Œå¦‚æœæ•°æ®æ ¼å¼æŠ¥é”™æ˜¯ä¸ä¼šè§¦å‘å…¨å±€çš„å¼‚å¸¸æ•è·ï¼Œè¿™é‡ŒBindingResultå·²ç»æ•è·äº†
     *
     * @param vo
     * @param rs
     * @return
     */
    @PostMapping("/add")
    public Object add(@RequestBody @Valid UserVO vo, BindingResult rs) {
        //æ‰“å°é”™è¯¯
        StringBuilder msg = new StringBuilder();
        if (rs.hasErrors()) {
            List<FieldError> fieldErrors = rs.getFieldErrors();
            fieldErrors.forEach(item -> msg.append(item.getDefaultMessage()).append(";"));
            return msg.toString();
        }
        return vo;
    }

    /**
     * æ¨èï¼šè¯·æ±‚æ•°æ®é”™è¯¯ç”±å…¨å±€å¼‚å¸¸å¤„ç†å™¨æ•è·ï¼Œè¿™é‡Œå…³æ³¨ä¸šåŠ¡
     *
     * @param vo
     * @return
     */
    @PostMapping("/add2")
    public Object add2(@RequestBody @Valid UserVO vo) {
        System.out.println("æ£€éªŒæˆåŠŸ...");
        return vo;
    }

}
```
1. åœ¨æ§åˆ¶å™¨å¯ä»¥ä½¿ç”¨ BindingResultæ³¨å…¥åˆ°æ–¹æ³•ç­¾åä¸Šï¼Œspringmvcä¼šå¸®æˆ‘ä»¬ä»£ç†æ ¡éªŒçš„ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è·å–åˆ°æ ¡éªŒç»“æœï¼Œå¦‚æ–¹æ³•add(@RequestBody @Valid UserVO vo, BindingResult rs)

**è¿™æ—¶å¦‚æœæœ‰å¼‚å¸¸æ˜¯ä¸ä¼šæŠ¥é”™ä¸­æ–­çº¿ç¨‹çš„ï¼Œè¦æˆ‘ä»¬è‡ªå·±å¤„ç†ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»ä»£ç†äº†è¿™ä¸ªç»“æœï¼Œä¸ç®¡æ ¡éªŒæ—¶å€™æ˜¯å¦é”™è¯¯ã€‚æˆ‘ä»¬ä¸€èˆ¬ä¸æ¨èè¿™ä¹ˆåšã€‚**

2. æ¨èï¼šæ¨èå…¨å±€å¼‚å¸¸æ•è·è¿›è¡Œç»Ÿä¸€çš„å¤„ç†ï¼Œæˆ‘ä»¬åªåšä¸šåŠ¡å¼€å‘ï¼Œå¦‚æ–¹æ³•add2(@RequestBody @Valid UserVO vo)

### å…¨å±€å¼‚å¸¸æ•è·
```java
/**
 * @Description: å…¨å±€å¼‚å¸¸å¤„ç†å™¨
 * @Author: jianweil
 * @date: 2022/3/1 10:37
 */
@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {

    /**
     * æ¥å£å‚æ•°æ•°æ®æ ¼å¼é”™è¯¯å¼‚å¸¸
     */
    @ExceptionHandler({MethodArgumentNotValidException.class})
    @ResponseStatus(HttpStatus.OK)
    @ResponseBody
    public Object handleMethodArgumentNotValidException(MethodArgumentNotValidException e) {
        log.error("MethodArgumentNotValidException");
        StringBuilder msg = new StringBuilder();
        e.getBindingResult().getAllErrors().forEach(item -> msg.append(item.getDefaultMessage()).append(";"));
        //è¿™é‡Œç®€å•åœ°è¿”å›å­—ç¬¦ä¸²ï¼Œå¤§å®¶å¯ä»¥å°è£…ç»Ÿä¸€æ ¼å¼çš„è¿”å›æ¨¡å‹
        return msg.toString();
    }

    @ExceptionHandler({Exception.class})
    @ResponseStatus(HttpStatus.OK)
    @ResponseBody
    public Object handleException(Exception e) {
        System.out.println(e);
        return e.getMessage();
    }
}
```

### è¯·æ±‚æµ‹è¯•
```http
###æ­£ç¡®è¯·æ±‚
POST http://localhost:8080/test/add2
Content-Type: application/json

{"name": "ljw","age": 18,"gender": 1,"email": "10086@qq.com"}


###é”™è¯¯è¯·æ±‚
POST http://localhost:8080/test/add2
Content-Type: application/json

{"name": "ljw","age": 18,"gender": 0,"email": "10086@qq.com"}
```
## å®æˆ˜2ï¼šä½¿ç”¨æšä¸¾ç±»è¿›è¡Œæ ¡éªŒ
åœ¨ä¸Šé¢æˆ‘ä»¬å·²ç»å®ç°äº†åˆ—ä¸¾æ‰€æœ‰ç¬¦å·è¦æ±‚çš„é›†åˆï¼Œä½¿ç”¨æ³¨è§£æ–¹å¼è¿›è¡Œæ ¡éªŒï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•å¹¶ä¸ä¼˜é›…ï¼Œæœ‰ç‚¹ç±»ä¼¼äº`é­”æ³•å€¼`ï¼Œå¦‚@ListValue(value = {"1", "2"}, message = "æ€§åˆ«å‚æ•°ä¸å¯¹")æˆ–@ListValue(value = {"A", "B"}, message = "æ€§åˆ«å‚æ•°ä¸å¯¹"),è¯­ä¹‰å¹¶ä¸æ¸…æ™°ã€‚

é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æšä¸¾ä»£æ›¿äº†é­”æ³•å€¼ã€‚æˆ‘ä»¬å¯ä»¥æŠŠåˆ—ä¸¾æ”¹ä¸ºæšä¸¾ã€‚

### æšä¸¾æ³¨è§£
```java
@Target({ElementType.METHOD, ElementType.FIELD, ElementType.ANNOTATION_TYPE, ElementType.CONSTRUCTOR, ElementType.PARAMETER})
@Documented
@Retention(RetentionPolicy.RUNTIME)
@Constraint(validatedBy = {EnumValueConstraintValidator.class})
public @interface EnumValue {

    // é»˜è®¤é”™è¯¯æ¶ˆæ¯
    String message() default "the integer is not one of the enum values";

    // çº¦æŸæ³¨è§£åœ¨éªŒè¯æ—¶æ‰€å±çš„ç»„åˆ«
    Class<?>[] groups() default {};

    // çº¦æŸæ³¨è§£çš„æœ‰æ•ˆè´Ÿè½½
    Class<? extends Payload>[] payload() default {};

    /**
     * éœ€è¦æ ¡éªŒæšä¸¾çš„å€¼
     *
     * @return
     */
    Class<? extends Enum> value();

}
```

### æ³¨è§£çº¦æŸéªŒè¯å™¨
```java
public class EnumValueConstraintValidator implements ConstraintValidator<EnumValue, Object> {

    private Set<Object> values = new HashSet<>();
    private Class<? extends Enum> enumClass;
    boolean required = true;

    /**
     * è¿™ä¸ªæ–¹æ³•åšä¸€äº›åˆå§‹åŒ–æ ¡éªŒ
     *
     * @param constraintAnnotation
     */
    @Override
    public void initialize(EnumValue constraintAnnotation) {
        enumClass = constraintAnnotation.value();
        try {
            // å…ˆåˆ¤æ–­è¯¥enumæ˜¯å¦å®ç°äº†getValueæ–¹æ³•
            enumClass.getDeclaredMethod(ValidatorEnumMapper.METHOD_NAME);
            for (Enum e : enumClass.getEnumConstants()) {
                Method declaredMethod = e.getClass().getDeclaredMethod(ValidatorEnumMapper.METHOD_NAME);
                Object obj = declaredMethod.invoke(e);
                values.add(obj);
            }
            required = constraintAnnotation.required();
        } catch (NoSuchMethodException e) {
            throw new IllegalArgumentException("the enum class has not getValue method", e);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    /**
     * è¿™ä¸ªæ–¹æ³•å†™å…·ä½“çš„æ ¡éªŒé€»è¾‘ï¼šæ ¡éªŒæ•°å­—æ˜¯å¦å±äºæŒ‡å®šæšä¸¾ç±»å‹çš„èŒƒå›´
     *
     * @param value
     * @param constraintValidatorContext
     * @return
     */
    @Override
    public boolean isValid(Object value, ConstraintValidatorContext constraintValidatorContext) {
        if (required) {
            if (Objects.isNull(value)) {
                return false;
            }
            return isPass(value);

        } else {
            //valueå¯ä»¥ä¸ºnull
            if (Objects.isNull(value)) {
                return true;
            }
            return isPass(value);
        }
    }

    /**
     * valueä¸ä¸ºnullæ—¶æ£€éªŒæ˜¯å¦åŒ¹é…
     *
     * @param value
     * @return
     */
    private boolean isPass(Object value) {
        //ä¸ä¸ºnull
        Enum[] enumConstants = enumClass.getEnumConstants();
        if (enumConstants == null) {
            // å¦‚æœä¸æ˜¯æšä¸¾ç±»å‹ï¼Œè¿”å› enumConstants = null
            return true;
        }
        return values.contains(value);
    }
}
```
### é¡¶å±‚æ¥å£
```java
/**
 * @Description: æšä¸¾æ ¡éªŒæ˜ å°„æ¥å£
 * @Author: jianweil
 * @date: 2022/3/1 15:24
 */
public interface ValidatorEnumMapper<T> {

    /**
     * åç§°å’Œä¸‹é¢æ–¹æ³•åç§°ç›¸åŒ
     */
    public static final String METHOD_NAME = "getValue";

    /**
     * æ³¨è§£çº¦æŸéªŒè¯å™¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•è·å–æšä¸¾çš„å€¼
     **/
    public T getValue();
}
```
å› ä¸ºæšä¸¾å¯èƒ½æœ‰å¤šä¸ªå±æ€§ï¼Œæˆ‘ä»¬éœ€è¦æ‹¿è¯·æ±‚å€¼åˆ°æšä¸¾ç±»ä¸­è¦æ ¡éªŒçš„å±æ€§åšå¯¹æ¯”ï¼Œæ‰€ä»¥è®¾è®¡ä¸€ä¸ªæ¥å£ï¼Œæšä¸¾ç±»è¦å®ç°è¯¥æ¥å£çš„æŠ½è±¡æ–¹æ³•ã€‚

### æšä¸¾ç±»
```java
public enum Gender implements ValidatorEnumMapper<Integer> {

    male(1, "ç”·"),
    female(2, "å¥³");

    private int value;
    private String type;

    Gender(int value, String type) {
        this.value = value;
        this.type = type;
    }

    @Override
    public Integer getValue() {
        return this.value;
    }
}
```
### è¯·æ±‚VO
```java
/**
 * @Description: ç”¨æˆ·VO
 * @Author: jianweil
 * @date: 2022/3/1 10:03
 */
@Data
public class UserVO {

    @NotBlank(message = "å§“åä¸èƒ½ä¸ºç©º")
    private String name;

    @Min(value = 18, message = "å¹´é¾„ä¸èƒ½å°äº18")
    private int age;
    /**
     * åˆ—ä¸¾æ€§åˆ«æšä¸¾å€¼: 1å¥³ 2ç”·
     */
    @ListValue(value = {"1", "2"}, message = "æ€§åˆ«å‚æ•°ä¸å¯¹", required = false)
    private Integer gender;

    @EnumValue(value = Gender.class, message = "ä¸åœ¨ç³»ç»Ÿæ”¯æŒçš„æšä¸¾èŒƒå›´å†…",required = false)
    private Integer genderEnum;

    @NotBlank(message = "é‚®ç®±ä¸èƒ½ä¸ºç©º")
    @Email(message = "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®")
    private String email;

}
```
### æ§åˆ¶å™¨@Validæ ¡éªŒ
```java
@RestController
@RequestMapping("/test")
public class TestController {
    /**
     * æ¨èï¼šè¯·æ±‚æ•°æ®é”™è¯¯ç”±å…¨å±€å¼‚å¸¸å¤„ç†å™¨æ•è·ï¼Œè¿™é‡Œå…³æ³¨ä¸šåŠ¡
     *
     * @param vo
     * @return
     */
    @PostMapping("/add2")
    public Object add2(@RequestBody @Valid UserVO vo) {
        System.out.println("æ£€éªŒæˆåŠŸ...");
        return vo;
    }

}
```

### è¯·æ±‚æµ‹è¯•
```http
###æ­£ç¡®è¯·æ±‚
POST http://localhost:8080/test/add2
Content-Type: application/json

{"name": "ljw","age": 18,"gender": 1,"genderEnum": 1,"email": "10086@qq.com"}

###æ­£ç¡®è¯·æ±‚
POST http://localhost:8080/test/add2
Content-Type: application/json

{"name": "ljw","age": 18,"gender": 1,"genderEnum": null,"email": "10086@qq.com"}

###é”™è¯¯è¯·æ±‚
POST http://localhost:8080/test/add2
Content-Type: application/json

{"name": "ljw","age": 18,"gender": 1,"genderEnum": 3,"email": "10086@qq.com"}
```

[æšä¸¾ç±»éªŒè¯ä¾‹å­å‚è€ƒï¼šä½ è¿˜åœ¨ç”¨ if åˆ¤æ–­å‚æ•°æ˜¯å¦åœ¨æšä¸¾èŒƒå›´å†…å—ï¼Ÿæˆ‘å·²ç»ç”¨ä¸Šæ³¨è§£äº†ã€‚](https://juejin.cn/post/7054571867197145101)

# æ‹¾é—-@RestControllerAdviceå’Œ@ControllerAdviceåŒºåˆ«
@RestControllerAdviceä¸@ControllerAdviceçš„åŒºåˆ«å°±å’Œ@RestControllerä¸@Controllerçš„åŒºåˆ«ç±»ä¼¼

@RestControllerAdviceæ³¨è§£åŒ…å«äº†@ControllerAdviceæ³¨è§£å’Œ@ResponseBodyæ³¨è§£ã€‚æ‰€ä»¥æ–¹æ³•ä¸Šå¯ä»¥å†™å°‘ä¸€ä¸ª@ResponseBodyæ³¨è§£


# å†™åœ¨æœ€å
- ğŸ‘ğŸ»ï¼šæœ‰æ”¶è·çš„ï¼Œç‚¹èµé¼“åŠ±ï¼
- â¤ï¸ï¼šæ”¶è—æ–‡ç« ï¼Œæ–¹ä¾¿å›çœ‹ï¼
- ğŸ’¬ï¼šè¯„è®ºäº¤æµï¼Œäº’ç›¸è¿›æ­¥ï¼